<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel Administrativo</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='admin.css') }}?v={{ range(1, 100000) | random }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='dark-mode.css') }}?v={{ range(1, 100000) | random }}">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
</head>

<body>

    <div class="flash-messages">
        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
        {% for category, message in messages %}
        <div class="alert alert-{{ category }}">
            {{ message }}
        </div>
        {% endfor %}
        {% endif %}
        {% endwith %}
    </div>

    <form method="POST" action="{{ url_for('delete_page') }}"
        onsubmit="return confirm('Tem certeza que deseja APAGAR SUA PÁGINA E CONTA permanentemente? Esta ação não pode ser desfeita!')"
        style="position: absolute; top: 20px; left: 20px; z-index: 1001;">
        <button type="submit" class="btn-delete">
            <i class="fas fa-trash"></i> Apagar Página e Conta
        </button>
    </form>

    <div class="admin-container">
        <div class="admin-header">
            <h1><i class="fas fa-cog"></i> Painel Administrativo</h1>
            <p>Edite suas informações pessoais e aparência da página</p>
        </div>

        <form method="POST" enctype="multipart/form-data" action="{{ url_for('admin_panel', username=dados.profile) }}"
            class="admin-form" id="admin-main-form">
            <div class="form-grid">
                <div class="form-section">
                    <h2><i class="fas fa-user"></i> Informações Pessoais</h2>
                    <div class="form-group">
                        <label for="nome">Nome Completo (Exibido na Página)</label>
                        <input type="text" id="nome" name="nome" value="{{ dados.nome }}" class="form-input" oninput="updateTextPreview('nome_preview', this.value, getValue('nome_font'), getValue('nome_color'))">
                        <div class="form-group-inline" style="margin-top: 8px;">
                            <label for="nome_font">Fonte:</label>
                            <select id="nome_font" name="nome_font" class="form-input" onchange="updateTextPreview('nome_preview', getValue('nome'), this.value, getValue('nome_color'))">
                                <option value="Inter, sans-serif" {% if dados.nome_font == 'Inter, sans-serif' %}selected{% endif %}>Padrão (Inter)</option>
                                <option value="Arial, sans-serif" {% if dados.nome_font == 'Arial, sans-serif' %}selected{% endif %}>Arial</option>
                                <option value="Verdana, sans-serif" {% if dados.nome_font == 'Verdana, sans-serif' %}selected{% endif %}>Verdana</option>
                                <option value="Georgia, serif" {% if dados.nome_font == 'Georgia, serif' %}selected{% endif %}>Georgia</option>
                                <option value="'Times New Roman', Times, serif" {% if dados.nome_font == "'Times New Roman', Times, serif" %}selected{% endif %}>Times New Roman</option>
                                <option value="'Courier New', Courier, monospace" {% if dados.nome_font == "'Courier New', Courier, monospace" %}selected{% endif %}>Courier New</option>
                                <option value="Roboto, sans-serif" {% if dados.nome_font == 'Roboto, sans-serif' %}selected{% endif %}>Roboto</option>
                                <option value="'Open Sans', sans-serif" {% if dados.nome_font == "'Open Sans', sans-serif" %}selected{% endif %}>Open Sans</option>
                                <option value="Lato, sans-serif" {% if dados.nome_font == 'Lato, sans-serif' %}selected{% endif %}>Lato</option>
                                <option value="Montserrat, sans-serif" {% if dados.nome_font == 'Montserrat, sans-serif' %}selected{% endif %}>Montserrat</option>
                            </select>
                            <label for="nome_color">Cor:</label>
                            <input type="color" id="nome_color" name="nome_color" value="{{ dados.nome_color | default(DEFAULT_TEXT_COLOR_PAGE, true) }}">
                        </div>
                        <div class="text-preview" id="nome_preview">Prévia do Nome</div>
                    </div>
                    <div class="form-group">
                        <label for="bio">Biografia (Exibida na Página)</label>
                        <textarea id="bio" name="bio" class="form-textarea" oninput="updateTextPreview('bio_preview', this.value, getValue('bio_font'), getValue('bio_color'))">{{ dados.bio }}</textarea>
                        <div class="form-group-inline" style="margin-top: 8px;">
                            <label for="bio_font">Fonte:</label>
                            <select id="bio_font" name="bio_font" class="form-input" onchange="updateTextPreview('bio_preview', getValue('bio'), this.value, getValue('bio_color'))">
                                <option value="Inter, sans-serif" {% if dados.bio_font == 'Inter, sans-serif' %}selected{% endif %}>Padrão (Inter)</option>
                                <option value="Arial, sans-serif" {% if dados.bio_font == 'Arial, sans-serif' %}selected{% endif %}>Arial</option>
                                <option value="Verdana, sans-serif" {% if dados.bio_font == 'Verdana, sans-serif' %}selected{% endif %}>Verdana</option>
                                <option value="Georgia, serif" {% if dados.bio_font == 'Georgia, serif' %}selected{% endif %}>Georgia</option>
                                <option value="'Times New Roman', Times, serif" {% if dados.bio_font == "'Times New Roman', Times, serif" %}selected{% endif %}>Times New Roman</option>
                                <option value="'Courier New', Courier, monospace" {% if dados.bio_font == "'Courier New', Courier, monospace" %}selected{% endif %}>Courier New</option>
                                <option value="Roboto, sans-serif" {% if dados.bio_font == 'Roboto, sans-serif' %}selected{% endif %}>Roboto</option>
                                <option value="'Open Sans', sans-serif" {% if dados.bio_font == "'Open Sans', sans-serif" %}selected{% endif %}>Open Sans</option>
                                <option value="Lato, sans-serif" {% if dados.bio_font == 'Lato, sans-serif' %}selected{% endif %}>Lato</option>
                                <option value="Montserrat, sans-serif" {% if dados.bio_font == 'Montserrat, sans-serif' %}selected{% endif %}>Montserrat</option>
                            </select>
                            <label for="bio_color">Cor:</label>
                            <input type="color" id="bio_color" name="bio_color" value="{{ dados.bio_color | default(DEFAULT_BIO_COLOR_PAGE, true) }}">
                        </div>
                        <div class="text-preview" id="bio_preview">Prévia da Biografia</div>
                    </div>
                    <div class="form-group">
                        <label for="profile">URL da sua página (Ex: seunome)</label>
                        <div class="profile-url">
                            <span class="url-prefix">cpages.onrender.com/</span>
                            <input type="text" id="profile" name="profile" value="{{ dados.profile }}" class="form-input"
                                pattern="[a-z0-9](?:[a-z0-9-]*[a-z0-9])?"
                                title="Apenas letras minúsculas, números e hífens. Não pode começar ou terminar com hífen. Ex: meu-perfil-123">
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h2><i class="fas fa-images"></i> Imagens e Fundo da Página Principal</h2>

                    <div class="form-group">
                        <label for="foto_upload">Foto de Perfil (Recomendado: Quadrada, ex: 300x300px)</label>
                        <div class="file-upload-wrapper">
                            <div class="file-upload">
                                <input type="file" id="foto_upload" name="foto_upload" accept="image/png, image/jpeg, image/gif" class="file-input"
                                    onchange="previewImage(this, 'foto_preview', 'foto_info')">
                                <label for="foto_upload" class="file-label">
                                    <i class="fas fa-cloud-upload-alt"></i> Escolher arquivo
                                </label>
                            </div>
                            <div class="file-info" id="foto_info">Nenhum arquivo selecionado</div>
                            <div class="image-preview-container" id="foto_preview_container">
                                <img src="{{ dados.foto if dados.foto else '' }}" class="image-preview" id="foto_preview"
                                    alt="Prévia da Foto de Perfil" onerror="this.style.display='none'; this.parentElement.style.display='none';">
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Fundo da Página Principal:</label>
                        <div class="card-background-options" style="margin-bottom: 10px;">
                            <label>
                                <input type="radio" name="background_type_page" value="image"
                                       {% if dados.background_type == 'image' or dados.background_type is none %}checked{% endif %}>
                                Enviar Imagem
                            </label>
                            <label>
                                <input type="radio" name="background_type_page" value="color"
                                       {% if dados.background_type == 'color' %}checked{% endif %}>
                                Selecionar Cor
                            </label>
                        </div>
                    </div>

                    <div id="background_page_image_options" class="form-group" style="display: {% if dados.background_type == 'image' or dados.background_type is none %}block{% else %}none{% endif %};">
                        <label for="background_upload">Imagem de Fundo da Página (Opcional)</label>
                        <div class="file-upload-wrapper">
                            <div class="file-upload">
                                <input type="file" id="background_upload" name="background_upload" accept="image/png, image/jpeg, image/gif" class="file-input"
                                    onchange="previewImage(this, 'background_preview_page', 'background_info_page')">
                                <label for="background_upload" class="file-label">
                                    <i class="fas fa-cloud-upload-alt"></i> Escolher arquivo de fundo
                                </label>
                            </div>
                            <div class="file-info" id="background_info_page">Nenhum arquivo selecionado</div>
                            <div class="image-preview-container" id="background_preview_page_container" style="position: relative; display: {% if dados.background %}block{% else %}none{% endif %};">
                                <img src="{{ dados.background if dados.background else '' }}" class="image-preview"
                                    id="background_preview_page" alt="Prévia do Fundo da Página" onerror="this.style.display='none'; this.parentElement.style.display='none';">
                                <div id="background_preview_page_overlay" class="image-preview-overlay"></div>
                            </div>
                        </div>

                        <div class="form-group-inline" style="margin-top: 15px; align-items: center;">
                            <input type="checkbox" id="background_image_darken_enabled_page" name="background_image_darken_enabled_page"
                                   {% if dados.background_image_darken_level | float > 0 %}checked{% endif %}>
                            <label for="background_image_darken_enabled_page" style="margin-bottom: 0;">Escurecer imagem de fundo</label>
                        </div>
                        <div id="background_image_darken_controls_page" class="form-group"
                             style="margin-top: 5px; display: {% if dados.background_image_darken_level | float > 0 %}block{% else %}none{% endif %};">
                            <label for="background_image_darken_level_page">Nível de Escurecimento:
                                <span id="darken_level_value_page">{{ "%.2f" | format(dados.background_image_darken_level | float) }}</span>
                            </label>
                            <input type="range" id="background_image_darken_level_page" name="background_image_darken_level_page"
                                   min="0" max="1" step="0.01" value="{{ dados.background_image_darken_level | float | default(0.0) }}" class="form-input">
                        </div>
                    </div>

                    <div id="background_page_color_options" class="form-group" style="display: {% if dados.background_type == 'color' %}block{% else %}none{% endif %};">
                        <label for="background_color_value_page">Cor de Fundo da Página:</label>
                        <div class="form-group-inline">
                            <input type="color" id="background_color_value_page" name="background_color_value_page"
                                   value="{{ dados.background_color_value | default(DEFAULT_BACKGROUND_COLOR_VALUE, true) }}" class="form-input" style="width: 60px; height: 40px; padding: 2px;">
                            <span id="background_color_hex_page" style="margin-left: 10px; font-family: monospace;">{{ dados.background_color_value | default(DEFAULT_BACKGROUND_COLOR_VALUE, true) }}</span>
                        </div>
                    </div>
                </div>


                <div class="form-section">
                    <h2><i class="fas fa-link"></i> Links e Botões (Página Principal)</h2>
                    <div class="buttons-container">
                        <button type="button" class="btn btn-add" id="add-icon-btn">
                            <i class="fas fa-plus"></i> Adicionar Ícone Social
                        </button>
                        <button type="button" class="btn btn-add" id="add-button-btn">
                            <i class="fas fa-plus"></i> Adicionar Botão Personalizado
                        </button>
                    </div>
                    <p style="font-size: 0.9em; margin-bottom: 10px;">Arraste os itens para reordenar.</p>
                    <div id="social-icons-container">
                        {% if dados.social_links %}
                            {% for link in dados.social_links %}
                            <div class="social-item">
                                <i class="fas fa-grip-vertical drag-handle" title="Arrastar para reordenar"></i>
                                <img src="{{ url_for('static', filename='icons/' + link.icon + '.png') }}" alt="{{ link.icon }}" width="24" height="24">
                                <input type="hidden" name="social_icon_name[]" value="{{ link.icon }}">
                                <input type="text" name="social_icon_url[]"
                                            value="{{ link.url }}"
                                            placeholder="Insira o link para {{ link.icon.replace('-', ' ') }}"
                                            class="form-input" required>
                                <span class="remove-item" title="Remover este ícone"><i class="fas fa-times"></i></span>
                            </div>
                            {% endfor %}
                        {% endif %}
                    </div>
                    <div id="custom-buttons-container">
                        {% if dados.custom_buttons %}
                            {% for button in dados.custom_buttons %}
                            <div class="custom-button-item">
                                <i class="fas fa-grip-vertical drag-handle" title="Arrastar para reordenar"></i>
                                <div style="flex-grow: 1;">
                                    <div class="button-preview
                                        {% if button.hasBorder %}has-border-preview{% endif %}
                                        {% if button.shadowType and button.shadowType != 'none' and button.buttonStyle == 'default' %}shadow-{{ button.shadowType }}{% endif %}
                                        button-style-{{ button.buttonStyle | default(DEFAULT_BUTTON_STYLE) }}"
                                        style="--btn-bg-color: {{ button.color | style_safe }}; --btn-opacity: {{ button.opacity | default(DEFAULT_BUTTON_OPACITY) }}; border-radius: {{ button.radius }}px; padding: 8px; margin-bottom: 8px; color: {{ button.textColor | style_safe }}; font-weight: {{ 'bold' if button.bold else 'normal' }}; font-style: {{ 'italic' if button.italic else 'normal' }}; font-size: {{ button.fontSize }}px; {% if button.hasBorder %}border: {{ button.borderWidth }}px solid {{ button.borderColor | style_safe }};{% endif %}
                                        {% if button.buttonStyle == 'solid_shadow' %}
                                            box-shadow: {{ button.shadowDepth | default(4) }}px {{ button.shadowDepth | default(4) }}px 0px 0px #000000 !important;
                                        {% endif %}">

                                        {% if button.iconUrl and button.iconType != 'none' %}
                                            {% if button.iconType == 'image_url_external' or button.iconType == 'image_uploaded' %}
                                                <img src="{{ button.iconUrl | e }}" alt="Ícone" class="button-embedded-icon {{ 'rounded' if button.iconRounded else '' }}">
                                            {% elif button.iconType == 'library_icon' %}
                                                <img src="{{ url_for('static', filename='icons/' + button.iconUrl) }}" alt="Ícone" class="button-embedded-icon {{ 'rounded' if button.iconRounded else '' }}">
                                            {% endif %}
                                        {% endif %}
                                        <span class="button-text-content">{{ button.text }}</span>
                                    </div>
                                    <input type="hidden" name="custom_button_text[]" value="{{ button.text | e }}">
                                    <input type="hidden" name="custom_button_link[]" value="{{ button.link | e }}">
                                    <input type="hidden" name="custom_button_color[]" value="{{ button.color | e }}">
                                    <input type="hidden" name="custom_button_radius[]" value="{{ button.radius }}">
                                    <input type="hidden" name="custom_button_text_color[]" value="{{ button.textColor | e }}">
                                    <input type="hidden" name="custom_button_text_bold[]" value="{{ 'true' if button.bold else 'false' }}">
                                    <input type="hidden" name="custom_button_text_italic[]" value="{{ 'true' if button.italic else 'false' }}">
                                    <input type="hidden" name="custom_button_font_size[]" value="{{ button.fontSize }}">
                                    <input type="hidden" name="custom_button_has_border[]" value="{{ 'true' if button.hasBorder else 'false' }}">
                                    <input type="hidden" name="custom_button_border_color[]" value="{{ button.borderColor | e }}">
                                    <input type="hidden" name="custom_button_border_width[]" value="{{ button.borderWidth }}">
                                    <input type="hidden" name="custom_button_hover_effect_type[]" value="{{ button.hoverEffectType | default('none') | e }}">
                                    <input type="hidden" name="custom_button_shadow_type[]" value="{{ button.shadowType | default('none') | e }}">
                                    <input type="hidden" name="custom_button_opacity[]" value="{{ button.opacity | default(DEFAULT_BUTTON_OPACITY) }}">
                                    <input type="hidden" name="custom_button_icon_url[]" value="{{ button.iconUrl | default('') | e }}">
                                    <input type="hidden" name="custom_button_icon_type[]" value="{{ button.iconType | default(DEFAULT_BUTTON_ICON_TYPE) | e }}">
                                    <input type="hidden" name="custom_button_icon_rounded[]" value="{{ 'true' if button.iconRounded else 'false' }}">
                                    <input type="hidden" name="custom_button_style[]" value="{{ button.buttonStyle | default(DEFAULT_BUTTON_STYLE) | e }}">
                                    <input type="hidden" name="custom_button_shadow_depth[]" value="{{ button.shadowDepth | default(DEFAULT_BUTTON_SHADOW_DEPTH) }}">
                                </div>
                                <button type="button" class="edit-item-btn" title="Editar este botão"><i class="fas fa-edit"></i></button>
                                <span class="remove-item" title="Remover este botão"><i class="fas fa-times"></i></span>
                            </div>
                            {% endfor %}
                        {% endif %}
                    </div>

                    <div id="icon-modal" class="modal">
                        <div class="modal-content">
                            <span class="close icon-modal-close" title="Fechar">&times;</span>
                            <h3>Selecione um Ícone</h3>
                            <div class="form-group">
                                <input type="text" id="icon-search" class="form-input" placeholder="Buscar ícones pelo nome...">
                            </div>
                            <div class="pagination-container">
                                <button type="button" class="pagination-btn" id="prev-icon-page" title="Página Anterior"><i class="fas fa-chevron-left"></i></button>
                                <div class="icons-grid"> </div>
                                <button type="button" class="pagination-btn" id="next-icon-page" title="Próxima Página"><i class="fas fa-chevron-right"></i></button>
                            </div>
                            <div class="page-info" style="text-align: center; margin-top: 10px; font-size: 0.9rem;">Página <span id="current-page">1</span></div>
                            <button type="button" id="save-icon" class="btn-save"><i class="fas fa-check"></i> Salvar Ícone Selecionado</button>
                        </div>
                    </div>

                    <div id="button-modal" class="modal">
                        <div class="modal-content">
                            <span class="close button-modal-close" title="Fechar">&times;</span>
                            <h3>Adicionar/Editar Botão Personalizado</h3>
                            <div id="button-preview-area">
                                <a href="#" id="live-button-preview" class="button-style-default" target="_blank" rel="noopener noreferrer" title="Prévia do botão">
                                    <span class="button-icon-preview"></span>
                                    <span class="button-text-preview">Texto do Botão</span>
                                </a>
                            </div>
                            <input type="hidden" id="button-modal-editing-index" value="-1"> <input type="hidden" id="button-modal-actual-icon-type" value="none">
                            <input type="hidden" id="button-modal-actual-icon-value" value="">


                            <div class="form-group"><label for="button-text">Texto do Botão:</label><input type="text" id="button-text" class="form-input" placeholder="Ex: Meu Portfólio"></div>
                            <div class="form-group"><label for="button-link">Link do Botão (URL completa):</label><input type="url" id="button-link" name="button-link" class="form-input" placeholder="https://exemplo.com"></div>

                            <div class="form-group">
                                <label for="button-style-select">Estilo do Botão:</label>
                                <select id="button-style-select" class="form-input">
                                    <option value="default">Padrão</option>
                                    <option value="solid_shadow">Sombra Destacada</option>
                                </select>
                            </div>

                            <div class="form-group" id="button-shadow-depth-group" style="display: none;">
                                <label for="button-shadow-depth">Profundidade da Sombra (Sombra Destacada): <span id="shadow-depth-value">4px</span></label>
                                <input type="range" id="button-shadow-depth" min="1" max="10" value="4" class="form-input">
                            </div>

                            <div class="form-group">
                                <label for="button-icon-type-select">Ícone/Imagem no Botão:</label>
                                <select id="button-icon-type-select" class="form-input">
                                    <option value="none" selected>Nenhum</option>
                                    <option value="image_url_external">Usar URL de Imagem Externa</option>
                                    <option value="image_upload_new">Enviar Nova Imagem</option>
                                    <option value="library_icon">Selecionar Ícone da Biblioteca</option>
                                </select>
                            </div>

                            <div class="form-group" id="button-icon-url-external-group" style="display: none;">
                                <label for="button-icon-url-external-input">URL da Imagem Externa:</label>
                                <input type="url" id="button-icon-url-external-input" class="form-input" placeholder="https://servidor.com/imagem.png">
                            </div>

                            <div class="form-group" id="button-new-image-file-group" style="display: none;">
                                <label for="button-new-image-file-input">Enviar Nova Imagem:</label>
                                <input type="file" id="button-new-image-file-input" class="form-input" accept="image/png, image/jpeg, image/gif">
                                <div class="file-info" id="button-new-image-file-info">Nenhum arquivo selecionado</div>
                            </div>

                            <div class="form-group" id="button-select-library-icon-group" style="display: none;">
                                <button type="button" id="button-select-library-icon-btn" class="btn btn-add" style="width: auto;">
                                    <i class="fas fa-icons"></i> Selecionar Ícone da Biblioteca
                                </button>
                                <div id="button-library-icon-name-preview" style="margin-top: 5px; font-style: italic;"></div>
                            </div>
                            <div class="form-group-inline" id="button-icon-rounded-group" style="display: none; margin-top: 5px;">
                                <input type="checkbox" id="button-icon-rounded"><label for="button-icon-rounded">Arredondar Imagem (estilo foto de perfil)</label>
                            </div>


                            <div class="form-group"><label for="button-color">Cor de Fundo do Botão:</label><input type="color" id="button-color" value="#4CAF50"></div>

                            <div class="form-group">
                                <label for="button-opacity">Opacidade do Fundo: <span id="opacity-value">1.00</span></label>
                                <input type="range" id="button-opacity" min="0" max="1" step="0.05" value="1.0" class="form-input">
                            </div>

                            <div class="form-group"><label for="button-radius">Arredondamento da Borda (px): <span id="radius-value">10px</span></label><input type="range" id="button-radius" min="0" max="30" value="10" class="form-input"></div>
                            <div class="form-group"><label for="button-text-color">Cor do Texto:</label><input type="color" id="button-text-color" value="#FFFFFF"></div>
                            <div class="form-group-inline"><label>Estilo do Texto:</label><input type="checkbox" id="button-text-bold" name="button-text-bold"><label for="button-text-bold">Negrito</label><input type="checkbox" id="button-text-italic" name="button-text-italic"><label for="button-text-italic">Itálico</label></div>
                            <div class="form-group"><label for="button-font-size">Tamanho da Fonte (px):</label><input type="number" id="button-font-size" min="10" max="30" value="16" class="form-input" style="width: 80px;"></div>

                            <div data-style-target="default">
                                <div class="form-group-inline">
                                    <input type="checkbox" id="button-has-border">
                                    <label for="button-has-border">Adicionar Borda</label>
                                </div>
                                <div id="border-options-group" style="display: none;" class="border-options-group">
                                    <div class="form-group-inline">
                                        <label for="button-border-color">Cor da Borda:</label>
                                        <input type="color" id="button-border-color" value="#000000">
                                    </div>
                                    <div class="form-group-inline">
                                        <label for="button-border-width">Largura (px):</label>
                                        <input type="number" id="button-border-width" min="1" max="10" value="2" class="form-input" style="width: 60px;">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="button-hover-effect-type"><strong>Efeito ao passar o mouse:</strong><br>(Passe o cursor do mouse em cima da prévia do botão para testar.)</label>
                                    <select id="button-hover-effect-type" class="form-input">
                                        <option value="none">Nenhum</option>
                                        <option value="elevate">Elevar</option>
                                        <option value="glow">Brilho Pulsante</option>
                                        <option value="fill_left">Preenchimento</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="button-shadow-type">Tipo de Sombra (Padrão):</label>
                                    <select id="button-shadow-type" class="form-input">
                                        <option value="none">Nenhuma</option><option value="soft">Suave</option>
                                        <option value="medium">Média</option><option value="hard">Forte</option><option value="inset">Interna</option>
                                    </select>
                                </div>
                            </div>
                            <button type="button" id="save-button" class="btn-save"><i class="fas fa-check"></i> Salvar Botão</button>
                        </div>
                    </div>
                </div>

                <div class="form-section card-section-full-width">
                    <h2><i class="fas fa-id-card"></i> Configurações do Cartão de Visitas</h2>
                    <div class="form-group">
                        <label for="card_nome">Nome Completo (Exibido no Cartão):</label>
                        <div class="input-group-card-text-style">
                            <input type="text" id="card_nome" name="card_nome" value="{{ dados.card_nome }}" class="form-input" oninput="updateTextPreview('card_nome_preview', this.value, getValue('card_nome_font'), getValue('card_nome_color'))">
                            <select id="card_nome_font" name="card_nome_font" class="form-input" onchange="updateTextPreview('card_nome_preview', getValue('card_nome'), this.value, getValue('card_nome_color'))">
                                <option value="Inter, sans-serif" {% if dados.card_nome_font == 'Inter, sans-serif' %}selected{% endif %}>Padrão (Inter)</option>
                                <option value="Arial, sans-serif" {% if dados.card_nome_font == 'Arial, sans-serif' %}selected{% endif %}>Arial</option>
                                <option value="Verdana, sans-serif" {% if dados.card_nome_font == 'Verdana, sans-serif' %}selected{% endif %}>Verdana</option>
                                <option value="Georgia, serif" {% if dados.card_nome_font == 'Georgia, serif' %}selected{% endif %}>Georgia</option>
                                <option value="'Times New Roman', Times, serif" {% if dados.card_nome_font == "'Times New Roman', Times, serif" %}selected{% endif %}>Times New Roman</option>
                                <option value="'Courier New', Courier, monospace" {% if dados.card_nome_font == "'Courier New', Courier, monospace" %}selected{% endif %}>Courier New</option>
                                <option value="Roboto, sans-serif" {% if dados.card_nome_font == 'Roboto, sans-serif' %}selected{% endif %}>Roboto</option>
                                <option value="'Open Sans', sans-serif" {% if dados.card_nome_font == "'Open Sans', sans-serif" %}selected{% endif %}>Open Sans</option>
                                <option value="Lato, sans-serif" {% if dados.card_nome_font == 'Lato, sans-serif' %}selected{% endif %}>Lato</option>
                                <option value="Montserrat, sans-serif" {% if dados.card_nome_font == 'Montserrat, sans-serif' %}selected{% endif %}>Montserrat</option>
                            </select>
                            <input type="color" id="card_nome_color" name="card_nome_color" value="{{ dados.card_nome_color | default(DEFAULT_TEXT_COLOR_CARD, true) }}">
                        </div>
                        <div class="text-preview" id="card_nome_preview">Prévia do Nome (Cartão)</div>
                    </div>

                    <div class="form-group">
                        <label for="card_titulo">Título/Profissão (Cartão):</label>
                        <div class="input-group-card-text-style">
                            <input type="text" id="card_titulo" name="card_titulo" value="{{ dados.card_titulo }}" class="form-input" oninput="updateTextPreview('card_titulo_preview', this.value, getValue('card_titulo_font'), getValue('card_titulo_color'))">
                            <select id="card_titulo_font" name="card_titulo_font" class="form-input" onchange="updateTextPreview('card_titulo_preview', getValue('card_titulo'), this.value, getValue('card_titulo_color'))">
                               <option value="Inter, sans-serif" {% if dados.card_titulo_font == 'Inter, sans-serif' %}selected{% endif %}>Padrão (Inter)</option>
                                <option value="Arial, sans-serif" {% if dados.card_titulo_font == 'Arial, sans-serif' %}selected{% endif %}>Arial</option>
                                <option value="Verdana, sans-serif" {% if dados.card_titulo_font == 'Verdana, sans-serif' %}selected{% endif %}>Verdana</option>
                                <option value="Georgia, serif" {% if dados.card_titulo_font == 'Georgia, serif' %}selected{% endif %}>Georgia</option>
                                <option value="'Times New Roman', Times, serif" {% if dados.card_titulo_font == "'Times New Roman', Times, serif" %}selected{% endif %}>Times New Roman</option>
                                <option value="'Courier New', Courier, monospace" {% if dados.card_titulo_font == "'Courier New', Courier, monospace" %}selected{% endif %}>Courier New</option>
                                <option value="Roboto, sans-serif" {% if dados.card_titulo_font == 'Roboto, sans-serif' %}selected{% endif %}>Roboto</option>
                                <option value="'Open Sans', sans-serif" {% if dados.card_titulo_font == "'Open Sans', sans-serif" %}selected{% endif %}>Open Sans</option>
                                <option value="Lato, sans-serif" {% if dados.card_titulo_font == 'Lato, sans-serif' %}selected{% endif %}>Lato</option>
                                <option value="Montserrat, sans-serif" {% if dados.card_titulo_font == 'Montserrat, sans-serif' %}selected{% endif %}>Montserrat</option>
                            </select>
                            <input type="color" id="card_titulo_color" name="card_titulo_color" value="{{ dados.card_titulo_color | default(DEFAULT_TITLE_COLOR_CARD, true) }}">
                        </div>
                         <div class="text-preview" id="card_titulo_preview">Prévia do Título</div>
                    </div>

                    <div class="form-group">
                        <label for="card_registro_profissional">Registro Profissional (Ex: CREA, OAB) (Cartão):</label>
                        <div class="input-group-card-text-style">
                            <input type="text" id="card_registro_profissional" name="card_registro_profissional" value="{{ dados.card_registro_profissional }}" class="form-input" oninput="updateTextPreview('card_registro_preview', this.value, getValue('card_registro_font'), getValue('card_registro_color'))">
                            <select id="card_registro_font" name="card_registro_font" class="form-input" onchange="updateTextPreview('card_registro_preview', getValue('card_registro_profissional'), this.value, getValue('card_registro_color'))">
                                <option value="Inter, sans-serif" {% if dados.card_registro_font == 'Inter, sans-serif' %}selected{% endif %}>Padrão (Inter)</option>
                                <option value="Arial, sans-serif" {% if dados.card_registro_font == 'Arial, sans-serif' %}selected{% endif %}>Arial</option>
                                <option value="Verdana, sans-serif" {% if dados.card_registro_font == 'Verdana, sans-serif' %}selected{% endif %}>Verdana</option>
                                <option value="Georgia, serif" {% if dados.card_registro_font == 'Georgia, serif' %}selected{% endif %}>Georgia</option>
                                <option value="'Times New Roman', Times, serif" {% if dados.card_registro_font == "'Times New Roman', Times, serif" %}selected{% endif %}>Times New Roman</option>
                                <option value="'Courier New', Courier, monospace" {% if dados.card_registro_font == "'Courier New', Courier, monospace" %}selected{% endif %}>Courier New</option>
                                <option value="Roboto, sans-serif" {% if dados.card_registro_font == 'Roboto, sans-serif' %}selected{% endif %}>Roboto</option>
                                <option value="'Open Sans', sans-serif" {% if dados.card_registro_font == "'Open Sans', sans-serif" %}selected{% endif %}>Open Sans</option>
                                <option value="Lato, sans-serif" {% if dados.card_registro_font == 'Lato, sans-serif' %}selected{% endif %}>Lato</option>
                                <option value="Montserrat, sans-serif" {% if dados.card_registro_font == 'Montserrat, sans-serif' %}selected{% endif %}>Montserrat</option>
                            </select>
                            <input type="color" id="card_registro_color" name="card_registro_color" value="{{ dados.card_registro_color | default(DEFAULT_REG_COLOR_CARD, true) }}">
                        </div>
                        <div class="text-preview" id="card_registro_preview">Prévia do Registro</div>
                    </div>

                    <div class="form-group">
                        <label for="card_endereco">Endereço (Ex: Cidade, Estado) (Cartão):</label>
                        <div class="input-group-card-text-style">
                            <input type="text" id="card_endereco" name="card_endereco" value="{{ dados.card_endereco }}" class="form-input" oninput="updateTextPreview('card_endereco_preview', this.value, getValue('card_endereco_font'), getValue('card_endereco_color'))">
                            <select id="card_endereco_font" name="card_endereco_font" class="form-input" onchange="updateTextPreview('card_endereco_preview', getValue('card_endereco'), this.value, getValue('card_endereco_color'))">
                                <option value="Inter, sans-serif" {% if dados.card_endereco_font == 'Inter, sans-serif' %}selected{% endif %}>Padrão (Inter)</option>
                                <option value="Arial, sans-serif" {% if dados.card_endereco_font == 'Arial, sans-serif' %}selected{% endif %}>Arial</option>
                                <option value="Verdana, sans-serif" {% if dados.card_endereco_font == 'Verdana, sans-serif' %}selected{% endif %}>Verdana</option>
                                <option value="Georgia, serif" {% if dados.card_endereco_font == 'Georgia, serif' %}selected{% endif %}>Georgia</option>
                                <option value="'Times New Roman', Times, serif" {% if dados.card_endereco_font == "'Times New Roman', Times, serif" %}selected{% endif %}>Times New Roman</option>
                                <option value="'Courier New', Courier, monospace" {% if dados.card_endereco_font == "'Courier New', Courier, monospace" %}selected{% endif %}>Courier New</option>
                                <option value="Roboto, sans-serif" {% if dados.card_endereco_font == 'Roboto, sans-serif' %}selected{% endif %}>Roboto</option>
                                <option value="'Open Sans', sans-serif" {% if dados.card_endereco_font == "'Open Sans', sans-serif" %}selected{% endif %}>Open Sans</option>
                                <option value="Lato, sans-serif" {% if dados.card_endereco_font == 'Lato, sans-serif' %}selected{% endif %}>Lato</option>
                                <option value="Montserrat, sans-serif" {% if dados.card_endereco_font == 'Montserrat, sans-serif' %}selected{% endif %}>Montserrat</option>
                            </select>
                            <input type="color" id="card_endereco_color" name="card_endereco_color" value="{{ dados.card_endereco_color | default(DEFAULT_CARD_ENDERECO_COLOR, true) }}">
                        </div>
                        <div class="text-preview" id="card_endereco_preview">Prévia do Endereço (Cartão)</div>
                    </div>
                    <div class="form-group">
                        <label>Fundo do Cartão de Visitas:</label>
                        <div class="card-background-options">
                            <label>
                                <input type="radio" name="card_background_type" value="color" {% if dados.card_background_type == 'color' or dados.card_background_type is none %}checked{% endif %}>
                                Cor Sólida
                                <input type="color" id="card_background_color_picker" name="card_background_value_color" value="{{ dados.card_background_value if dados.card_background_type == 'color' else DEFAULT_CARD_BG_COLOR }}" class="form-input" style="width: 50px; height: 30px; padding:0; border: none;">
                            </label>
                            <label>
                                <input type="radio" name="card_background_type" value="image" {% if dados.card_background_type == 'image' %}checked{% endif %}>
                                Imagem
                            </label>
                        </div>
                        <div id="card_background_image_upload_section" style="display: {% if dados.card_background_type == 'image' %}block{% else %}none{% endif %};">
                            <div class="file-upload-wrapper">
                                <div class="file-upload">
                                    <input type="file" id="card_background_upload" name="card_background_upload" accept="image/png, image/jpeg, image/gif" class="file-input"
                                        onchange="previewImage(this, 'card_background_image_preview', 'card_background_info');">
                                    <label for="card_background_upload" class="file-label">
                                        <i class="fas fa-cloud-upload-alt"></i> Escolher imagem para o fundo do cartão
                                    </label>
                                </div>
                                <div class="file-info" id="card_background_info">
                                    Nenhum arquivo selecionado
                                </div>
                                <div class="image-preview-container" id="card_background_image_preview_container" style="display: {% if dados.card_background_type == 'image' and dados.card_background_value %}block{% else %}none{% endif %};">
                                    <img src="{{ dados.card_background_value if dados.card_background_type == 'image' else '' }}" class="image-preview" id="card_background_image_preview"
                                        alt="Prévia do Fundo do Cartão" onerror="this.style.display='none'; this.parentElement.style.display='none';">
                                    <button type="button" class="btn-delete btn-sm" id="remove_card_background_image_btn" style="margin-top: 10px; display: {% if dados.card_background_type == 'image' and dados.card_background_value %}inline-flex{% else %}none{% endif %}; align-items: center; gap: 5px;" title="Remover imagem de fundo do cartão"><i class="fas fa-times-circle"></i>Remover Imagem</button>
                                    <input type="hidden" name="remove_card_background_image" id="remove_card_background_image" value="false">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="form-group form-group-inline">
                        <label for="card_link_text_color">Cor Padrão do Texto dos Links do Cartão:</label>
                        <input type="color" id="card_link_text_color" name="card_link_text_color" value="{{ dados.card_link_text_color | default(DEFAULT_CARD_LINK_TEXT_COLOR, true) }}">
                    </div>

                    <div class="form-group">
                        <label>Links Customizáveis do Cartão (até 3):</label>
                        <button type="button" class="btn btn-add" id="add-card-link-btn">
                            <i class="fas fa-plus"></i> Adicionar Link ao Cartão
                        </button>
                        <p style="font-size: 0.9em; margin-bottom: 10px;">Arraste os itens para reordenar.</p>
                        <div id="card-links-container">
                            {% if dados.card_links %}
                                {% for link in dados.card_links %}
                                <div class="card-link-item">
                                    <i class="fas fa-grip-vertical drag-handle" title="Arrastar para reordenar"></i>
                                    <img src="{{ url_for('static', filename='icons/' + link.icon + '.png') }}" alt="{{ link.icon }}" width="24" height="24">
                                    <input type="hidden" name="card_icon_name[]" value="{{ link.icon }}">
                                    <div class="input-group">
                                        <input type="url" name="card_icon_url[]"
                                                    value="{{ link.url }}"
                                                    placeholder="URL do Link (Opcional)"
                                                    class="form-input">
                                        <input type="text" name="card_icon_at_text[]"
                                                    value="{{ link.at_text }}"
                                                    placeholder="Texto exibido (ex: @meuusuario)"
                                                    class="form-input card-link-item-at-text">
                                    </div>
                                    <div class="card-link-style-controls">
                                        <input type="hidden" name="card_icon_font[]" value="{{ link.font | default(DEFAULT_FONT, true) }}">
                                        <select class="form-input card-link-item-font" title="Fonte do texto do link">
                                            <option value="Inter, sans-serif" {% if (link.font | default(DEFAULT_FONT, true)) == 'Inter, sans-serif' %}selected{% endif %}>Padrão (Inter)</option>
                                            <option value="Arial, sans-serif" {% if (link.font | default(DEFAULT_FONT, true)) == 'Arial, sans-serif' %}selected{% endif %}>Arial</option>
                                            <option value="Verdana, sans-serif" {% if (link.font | default(DEFAULT_FONT, true)) == 'Verdana, sans-serif' %}selected{% endif %}>Verdana</option>
                                            <option value="Georgia, serif" {% if (link.font | default(DEFAULT_FONT, true)) == 'Georgia, serif' %}selected{% endif %}>Georgia</option>
                                            <option value="'Times New Roman', Times, serif" {% if (link.font | default(DEFAULT_FONT, true)) == "'Times New Roman', Times, serif" %}selected{% endif %}>Times New Roman</option>
                                            <option value="'Courier New', Courier, monospace" {% if (link.font | default(DEFAULT_FONT, true)) == "'Courier New', Courier, monospace" %}selected{% endif %}>Courier New</option>
                                            <option value="Roboto, sans-serif" {% if (link.font | default(DEFAULT_FONT, true)) == 'Roboto, sans-serif' %}selected{% endif %}>Roboto</option>
                                            <option value="'Open Sans', sans-serif" {% if (link.font | default(DEFAULT_FONT, true)) == "'Open Sans', sans-serif" %}selected{% endif %}>Open Sans</option>
                                            <option value="Lato, sans-serif" {% if (link.font | default(DEFAULT_FONT, true)) == 'Lato, sans-serif' %}selected{% endif %}>Lato</option>
                                            <option value="Montserrat, sans-serif" {% if (link.font | default(DEFAULT_FONT, true)) == 'Montserrat, sans-serif' %}selected{% endif %}>Montserrat</option>
                                        </select>
                                        <input type="hidden" name="card_icon_color[]" value="{{ link.color | default(dados.card_link_text_color, true) | default(DEFAULT_TEXT_COLOR_CARD, true) }}">
                                        <input type="color" class="card-link-item-color" title="Cor do texto do link" value="{{ link.color | default(dados.card_link_text_color, true) | default(DEFAULT_TEXT_COLOR_CARD, true) }}">
                                    </div>
                                    <div class="card-link-item-preview" title="Prévia do texto do link"></div>
                                    <span class="remove-item" title="Remover este link do cartão"><i class="fas fa-times"></i></span>
                                </div>
                                {% endfor %}
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            <div class="form-actions">
                <button type="submit" class="btn-save">
                    <i class="fas fa-save"></i> Salvar Todas as Alterações
                </button>
                <a href="{{ url_for('logout') }}" class="btn-logout">
                    <i class="fas fa-sign-out-alt"></i> Sair do Painel
                </a>
            </div>
        </form>
    </div>
    <script>
        // Passando constantes do Flask para o JavaScript
        const DEFAULT_FONT_JS = "{{ DEFAULT_FONT | e }}";
        const DEFAULT_TEXT_COLOR_PAGE_JS = "{{ DEFAULT_TEXT_COLOR_PAGE | e }}";
        const DEFAULT_BIO_COLOR_PAGE_JS = "{{ DEFAULT_BIO_COLOR_PAGE | e }}";
        const DEFAULT_TEXT_COLOR_CARD_JS = "{{ DEFAULT_TEXT_COLOR_CARD | e }}";
        const DEFAULT_TITLE_COLOR_CARD_JS = "{{ DEFAULT_TITLE_COLOR_CARD | e }}";
        const DEFAULT_REG_COLOR_CARD_JS = "{{ DEFAULT_REG_COLOR_CARD | e }}";
        const DEFAULT_CARD_BG_COLOR_JS = "{{ DEFAULT_CARD_BG_COLOR | e }}";
        const DEFAULT_CARD_LINK_TEXT_COLOR_JS = "{{ DEFAULT_CARD_LINK_TEXT_COLOR | e }}";
        const DEFAULT_CARD_ENDERECO_COLOR_JS = "{{ DEFAULT_CARD_ENDERECO_COLOR | e }}";

        // Novas constantes globais para JS para defaults de botões
        const DEFAULT_BUTTON_OPACITY_JS = parseFloat("{{ DEFAULT_BUTTON_OPACITY }}");
        const DEFAULT_BUTTON_ICON_URL_JS = "{{ DEFAULT_BUTTON_ICON_URL | e }}";
        const DEFAULT_BUTTON_ICON_TYPE_JS = "{{ DEFAULT_BUTTON_ICON_TYPE | e }}";
        const DEFAULT_BUTTON_ICON_ROUNDED_JS = "{{ 'true' if DEFAULT_BUTTON_ICON_ROUNDED else 'false' }}" === 'true';
        const DEFAULT_BUTTON_STYLE_JS = "{{ DEFAULT_BUTTON_STYLE | e }}";
        const DEFAULT_BUTTON_SHADOW_DEPTH_JS = parseInt("{{ DEFAULT_BUTTON_SHADOW_DEPTH | default(4) }}"); // NOVO: Default para profundidade da sombra
        const STATIC_ICONS_PATH = "{{ url_for('static', filename='icons/') }}";
        const UPLOAD_BUTTON_IMAGE_URL = "{{ url_for('upload_button_temp_image') }}";

        // Novas constantes para o fundo da página principal
        const DEFAULT_BACKGROUND_TYPE_JS = "{{ DEFAULT_BACKGROUND_TYPE | e }}";
        const DEFAULT_BACKGROUND_IMAGE_DARKEN_LEVEL_JS = parseFloat("{{ DEFAULT_BACKGROUND_IMAGE_DARKEN_LEVEL }}");
        const DEFAULT_BACKGROUND_COLOR_VALUE_JS = "{{ DEFAULT_BACKGROUND_COLOR_VALUE | e }}";

    </script>
    <script src="{{ url_for('static', filename='js/admin.js') }}?v={{ range(1, 100000) | random }}" defer></script>
    <script src="{{ url_for('static', filename='js/dark-mode.js') }}?v={{ range(1, 100000) | random }}"></script>
    <a href="/{{ dados.profile }}" class="preview-float-btn" target="_blank" title="Visualizar sua página em uma nova aba">
        <i class="fas fa-eye"></i>
        <span class="preview-float-tooltip">Visualizar Página</span>
    </a>
</body>
</html>