<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel Administrativo</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='admin.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='dark-mode.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
</head>

<body>

    <div class="flash-messages">
        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
        {% for category, message in messages %}
        <div class="alert alert-{{ category }}">
            {{ message }}
        </div>
        {% endfor %}
        {% endif %}
        {% endwith %}
    </div>

    <form method="POST" action="{{ url_for('delete_page') }}"
        onsubmit="return confirm('Tem certeza que deseja APAGAR SUA PÁGINA permanentemente? Esta ação não pode ser desfeita!')"
        style="position: absolute; top: 20px; left: 20px;">
        <button type="submit" class="btn-delete">
            <i class="fas fa-trash"></i> Apagar Página
        </button>
    </form>

    <div class="admin-container">
        <div class="admin-header">
            <h1><i class="fas fa-cog"></i> Painel Administrativo</h1>
            <p>Edite suas informações pessoais</p>
        </div>

        <form method="POST" enctype="multipart/form-data" action="{{ url_for('admin_panel', username=dados.profile) }}"
            class="admin-form">
            <div class="form-grid">
                <div class="form-section">
                    <h2><i class="fas fa-user"></i> Informações Pessoais</h2>

                    <div class="form-group">
                        <label for="nome">Nome Completo</label>
                        <input type="text" id="nome" name="nome" value="{{ dados.nome }}" class="form-input" oninput="updateTextPreview('nome_preview', this.value, getValue('nome_font'), getValue('nome_color'))">
                        <div class="form-group-inline" style="margin-top: 8px;">
                            <label for="nome_font">Fonte:</label>
                            <select id="nome_font" name="nome_font" class="form-input" onchange="updateTextPreview('nome_preview', getValue('nome'), this.value, getValue('nome_color'))">
                                <option value="Inter, sans-serif" {% if dados.nome_font == 'Inter, sans-serif' %}selected{% endif %}>Padrão (Inter)</option>
                                <option value="Arial, sans-serif" {% if dados.nome_font == 'Arial, sans-serif' %}selected{% endif %}>Arial</option>
                                <option value="Verdana, sans-serif" {% if dados.nome_font == 'Verdana, sans-serif' %}selected{% endif %}>Verdana</option>
                                <option value="Georgia, serif" {% if dados.nome_font == 'Georgia, serif' %}selected{% endif %}>Georgia</option>
                                <option value="'Times New Roman', Times, serif" {% if dados.nome_font == "'Times New Roman', Times, serif" %}selected{% endif %}>Times New Roman</option>
                                <option value="'Courier New', Courier, monospace" {% if dados.nome_font == "'Courier New', Courier, monospace" %}selected{% endif %}>Courier New</option>
                                <option value="Roboto, sans-serif" {% if dados.nome_font == 'Roboto, sans-serif' %}selected{% endif %}>Roboto</option>
                                <option value="'Open Sans', sans-serif" {% if dados.nome_font == "'Open Sans', sans-serif" %}selected{% endif %}>Open Sans</option>
                                <option value="Lato, sans-serif" {% if dados.nome_font == 'Lato, sans-serif' %}selected{% endif %}>Lato</option>
                                <option value="Montserrat, sans-serif" {% if dados.nome_font == 'Montserrat, sans-serif' %}selected{% endif %}>Montserrat</option>
                            </select>
                            <label for="nome_color">Cor:</label>
                            <input type="color" id="nome_color" name="nome_color" value="{{ dados.nome_color | default('#333333', true) }}" oninput="updateTextPreview('nome_preview', getValue('nome'), getValue('nome_font'), this.value)">
                        </div>
                        <div class="text-preview" id="nome_preview">Prévia do Nome</div>
                    </div>

                    <div class="form-group">
                        <label for="bio">Biografia</label>
                        <textarea id="bio" name="bio" class="form-textarea" oninput="updateTextPreview('bio_preview', this.value, getValue('bio_font'), getValue('bio_color'))">{{ dados.bio }}</textarea>
                        <div class="form-group-inline" style="margin-top: 8px;">
                            <label for="bio_font">Fonte:</label>
                            <select id="bio_font" name="bio_font" class="form-input" onchange="updateTextPreview('bio_preview', getValue('bio'), this.value, getValue('bio_color'))">
                                <option value="Inter, sans-serif" {% if dados.bio_font == 'Inter, sans-serif' %}selected{% endif %}>Padrão (Inter)</option>
                                <option value="Arial, sans-serif" {% if dados.bio_font == 'Arial, sans-serif' %}selected{% endif %}>Arial</option>
                                <option value="Verdana, sans-serif" {% if dados.bio_font == 'Verdana, sans-serif' %}selected{% endif %}>Verdana</option>
                                <option value="Georgia, serif" {% if dados.bio_font == 'Georgia, serif' %}selected{% endif %}>Georgia</option>
                                <option value="'Times New Roman', Times, serif" {% if dados.bio_font == "'Times New Roman', Times, serif" %}selected{% endif %}>Times New Roman</option>
                                <option value="'Courier New', Courier, monospace" {% if dados.bio_font == "'Courier New', Courier, monospace" %}selected{% endif %}>Courier New</option>
                                <option value="Roboto, sans-serif" {% if dados.bio_font == 'Roboto, sans-serif' %}selected{% endif %}>Roboto</option>
                                <option value="'Open Sans', sans-serif" {% if dados.bio_font == "'Open Sans', sans-serif" %}selected{% endif %}>Open Sans</option>
                                <option value="Lato, sans-serif" {% if dados.bio_font == 'Lato, sans-serif' %}selected{% endif %}>Lato</option>
                                <option value="Montserrat, sans-serif" {% if dados.bio_font == 'Montserrat, sans-serif' %}selected{% endif %}>Montserrat</option>
                            </select>
                            <label for="bio_color">Cor:</label>
                            <input type="color" id="bio_color" name="bio_color" value="{{ dados.bio_color | default('#555555', true) }}" oninput="updateTextPreview('bio_preview', getValue('bio'), getValue('bio_font'), this.value)">
                        </div>
                        <div class="text-preview" id="bio_preview">Prévia da Biografia</div>
                    </div>

                    <div class="form-group">
                        <label for="profile">URL da sua página</label>
                        <div class="profile-url">
                            <span class="url-prefix">cpages.onrender.com/</span> <input type="text" id="profile" name="profile" value="{{ dados.profile }}" class="form-input"
                                pattern="[a-z0-9-]+" title="Apenas letras minúsculas, números e hífens">
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h2><i class="fas fa-images"></i> Imagens da Página</h2>

                    <div class="form-group">
                        <label for="foto_upload">Foto de Perfil</label>
                        <div class="file-upload-wrapper">
                            <div class="file-upload">
                                <input type="file" id="foto_upload" name="foto_upload" accept="image/*" class="file-input"
                                    onchange="previewImage(this, 'foto_preview', 'foto_info')">
                                <label for="foto_upload" class="file-label">
                                    <i class="fas fa-cloud-upload-alt"></i> Escolher arquivo
                                </label>
                            </div>
                            <div class="file-info" id="foto_info">Nenhum arquivo selecionado</div>
                            <div class="image-preview-container" id="foto_preview_container">
                                <img src="{{ dados.foto if dados.foto else '' }}" class="image-preview" id="foto_preview"
                                    onerror="this.style.display='none'">
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="background_upload">Imagem de Fundo da Página</label>
                        <div class="file-upload-wrapper">
                            <div class="file-upload">
                                <input type="file" id="background_upload" name="background_upload" accept="image/*" class="file-input"
                                    onchange="previewImage(this, 'background_preview', 'background_info')">
                                <label for="background_upload" class="file-label">
                                    <i class="fas fa-cloud-upload-alt"></i> Escolher arquivo
                                </label>
                            </div>
                            <div class="file-info" id="background_info">Nenhum arquivo selecionado</div>
                            <div class="image-preview-container" id="background_preview_container">
                                <img src="{{ dados.background if dados.background else '' }}" class="image-preview"
                                    id="background_preview" onerror="this.style.display='none'">
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="form-section">
                    <h2><i class="fas fa-link"></i> Links Sociais e Botões</h2>

                    <div class="buttons-container">
                        <button type="button" class="btn btn-add" id="add-icon-btn">
                            <i class="fas fa-plus"></i> Adicionar Ícone Social
                        </button>
                        <button type="button" class="btn btn-add" id="add-button-btn">
                            <i class="fas fa-plus"></i> Adicionar Botão Personalizado
                        </button>
                    </div>

                    <div id="social-icons-container">
                        {% if dados.social_links %}
                            {% for link in dados.social_links %}
                            <div class="social-item">
                                <i class="fas fa-grip-vertical drag-handle"></i> <img src="/static/icons/{{ link.icon }}.png" alt="{{ link.icon }}" width="24">
                                <input type="hidden" name="social_icon_name[]" value="{{ link.icon }}">
                                <input type="text" name="social_icon_url[]"
                                            value="{{ link.url }}"
                                            placeholder="Insira o link para {{ link.icon.replace('-', ' ') }}"
                                            class="form-input" required>
                                <span class="remove-item"><i class="fas fa-times"></i></span>
                            </div>
                            {% endfor %}
                        {% endif %}
                    </div>

                    <div id="custom-buttons-container">
                        {% if dados.custom_buttons %}
                            {% for button in dados.custom_buttons %}
                            <div class="custom-button-item">
                                <i class="fas fa-grip-vertical drag-handle"></i> <div style="flex-grow: 1;">
                                    <div class="button-preview {% if button.hasBorder %}has-border-preview{% endif %} {% if button.hasHoverEffect %}hover-effect-preview{% endif %} {% if button.shadowType %}shadow-{{ button.shadowType }}{% endif %}"
                                        style="background: {{ button.color }}; border-radius: {{ button.radius }}px; padding: 8px; margin-bottom: 8px; color: {{ button.textColor }}; font-weight: {{ 'bold' if button.bold else 'normal' }}; font-style: {{ 'italic' if button.italic else 'normal' }}; font-size: {{ button.fontSize }}px; {% if button.hasBorder %}border: {{ button.borderWidth }}px solid {{ button.borderColor }};{% endif %}">
                                        {{ button.text }}
                                    </div>
                                    <input type="hidden" name="custom_button_text[]" value="{{ button.text }}">
                                    <input type="hidden" name="custom_button_link[]" value="{{ button.link }}">
                                    <input type="hidden" name="custom_button_color[]" value="{{ button.color }}">
                                    <input type="hidden" name="custom_button_radius[]" value="{{ button.radius }}">
                                    <input type="hidden" name="custom_button_text_color[]" value="{{ button.textColor }}">
                                    <input type="hidden" name="custom_button_text_bold[]" value="{{ 'true' if button.bold else 'false' }}">
                                    <input type="hidden" name="custom_button_text_italic[]" value="{{ 'true' if button.italic else 'false' }}">
                                    <input type="hidden" name="custom_button_font_size[]" value="{{ button.fontSize }}">
                                    <input type="hidden" name="custom_button_has_border[]" value="{{ 'true' if button.hasBorder else 'false' }}">
                                    <input type="hidden" name="custom_button_border_color[]" value="{{ button.borderColor }}">
                                    <input type="hidden" name="custom_button_border_width[]" value="{{ button.borderWidth }}">
                                    <input type="hidden" name="custom_button_has_hover[]" value="{{ 'true' if button.hasHoverEffect else 'false' }}">
                                    <input type="hidden" name="custom_button_shadow_type[]" value="{{ button.shadowType | default('none') }}">
                                </div>
                                <span class="remove-item"><i class="fas fa-times"></i></span>
                            </div>
                            {% endfor %}
                        {% endif %}
                    </div>

                    <div id="icon-modal" class="modal">
                        <div class="modal-content">
                            <span class="close icon-modal-close">&times;</span>
                            <h3>Selecione um ícone</h3>
                            <div class="form-group">
                                <input type="text" id="icon-search" class="form-input" placeholder="Buscar ícones...">
                            </div>
                            <div class="pagination-container">
                                <button type="button" class="pagination-btn" id="prev-icon-page"><i class="fas fa-chevron-left"></i></button>
                                <div class="icons-grid"></div>
                                <button type="button" class="pagination-btn" id="next-icon-page"><i class="fas fa-chevron-right"></i></button>
                            </div>
                            <div class="page-info" style="text-align: center; margin-top: 10px; font-size: 0.9rem;">Página <span id="current-page">1</span></div>
                            <button type="button" id="save-icon" class="btn-save">Salvar Ícone</button>
                        </div>
                    </div>

                    <div id="button-modal" class="modal">
                        <div class="modal-content">
                            <span class="close button-modal-close">&times;</span>
                            <h3>Criar Novo Botão</h3>
                            <div id="button-preview-area">
                                <a href="#" id="live-button-preview">Texto do Botão</a>
                            </div>
                            <div class="form-group"><label for="button-text">Texto do Botão</label><input type="text" id="button-text" class="form-input" placeholder="Ex: Currículo"></div>
                            <div class="form-group"><label for="button-link">Link</label><input type="text" id="button-link" class="form-input" placeholder="https://"></div>
                            <div class="form-group"><label for="button-color">Cor do Botão</label><input type="color" id="button-color" value="#4CAF50"></div>
                            <div class="form-group"><label for="button-radius">Arredondamento (px)</label><input type="range" id="button-radius" min="0" max="20" value="10"><span id="radius-value">10px</span></div>
                            <div class="form-group"><label for="button-text-color">Cor do Texto</label><input type="color" id="button-text-color" value="#FFFFFF"></div>
                            <div class="form-group-inline"><label>Estilo do Texto:</label><input type="checkbox" id="button-text-bold" name="button-text-bold"><label for="button-text-bold">Negrito</label><input type="checkbox" id="button-text-italic" name="button-text-italic"><label for="button-text-italic">Itálico</label></div>
                            <div class="form-group"><label for="button-font-size">Tamanho da Fonte (px)</label><input type="number" id="button-font-size" min="12" max="30" value="16" class="form-input"></div>
                            <div class="form-group-inline"><input type="checkbox" id="button-has-border"><label for="button-has-border">Adicionar Borda</label><div id="border-options-group" style="display: none;" class="border-options-group"><div class="form-group-inline"><label for="button-border-color">Cor</label><input type="color" id="button-border-color" value="#000000"></div><div class="form-group-inline"><label for="button-border-width">Tamanho (px)</label><input type="number" id="button-border-width" min="1" max="10" value="2" class="form-input" style="width: 60px;"></div></div></div>
                            <div class="form-group-inline"><input type="checkbox" id="button-has-hover"><label for="button-has-hover">Efeito Hover</label></div>
                            <div class="form-group"><label for="button-shadow-type">Tipo de Sombra</label><select id="button-shadow-type" class="form-input"><option value="none">Nenhuma</option><option value="soft">Suave</option><option value="medium">Média</option><option value="hard">Forte</option><option value="inset">Interna (Inset)</option></select></div>
                            <button type="button" id="save-button" class="btn-save">Salvar Botão</button>
                        </div>
                    </div>
                </div>

                <div class="form-section card-section-full-width"> 
                    <h2><i class="fas fa-id-card"></i> Cartão de Visitas</h2>
                    
                    <div class="form-group">
                        <label for="card_nome">Nome Completo (Cartão)</label>
                        <div class="input-group-card-text-style">
                            <input type="text" id="card_nome" name="card_nome" value="{{ dados.card_nome }}" class="form-input" oninput="updateTextPreview('card_nome_preview', this.value, getValue('card_nome_font'), getValue('card_nome_color'))">
                            <select id="card_nome_font" name="card_nome_font" class="form-input" onchange="updateTextPreview('card_nome_preview', getValue('card_nome'), this.value, getValue('card_nome_color'))">
                                <option value="Inter, sans-serif" {% if dados.card_nome_font == 'Inter, sans-serif' %}selected{% endif %}>Padrão (Inter)</option>
                                <option value="Arial, sans-serif" {% if dados.card_nome_font == 'Arial, sans-serif' %}selected{% endif %}>Arial</option>
                                <option value="Verdana, sans-serif" {% if dados.card_nome_font == 'Verdana, sans-serif' %}selected{% endif %}>Verdana</option>
                                <option value="Georgia, serif" {% if dados.card_nome_font == 'Georgia, serif' %}selected{% endif %}>Georgia</option>
                                <option value="'Times New Roman', Times, serif" {% if dados.card_nome_font == "'Times New Roman', Times, serif" %}selected{% endif %}>Times New Roman</option>
                                <option value="'Courier New', Courier, monospace" {% if dados.card_nome_font == "'Courier New', Courier, monospace" %}selected{% endif %}>Courier New</option>
                                <option value="Roboto, sans-serif" {% if dados.card_nome_font == 'Roboto, sans-serif' %}selected{% endif %}>Roboto</option>
                                <option value="'Open Sans', sans-serif" {% if dados.card_nome_font == "'Open Sans', sans-serif" %}selected{% endif %}>Open Sans</option>
                                <option value="Lato, sans-serif" {% if dados.card_nome_font == 'Lato, sans-serif' %}selected{% endif %}>Lato</option>
                                <option value="Montserrat, sans-serif" {% if dados.card_nome_font == 'Montserrat, sans-serif' %}selected{% endif %}>Montserrat</option>
                            </select>
                            <input type="color" id="card_nome_color" name="card_nome_color" value="{{ dados.card_nome_color | default(DEFAULT_TEXT_COLOR_CARD, true) }}" oninput="updateTextPreview('card_nome_preview', getValue('card_nome'), getValue('card_nome_font'), this.value)">
                        </div>
                        <div class="text-preview" id="card_nome_preview">Prévia do Nome (Cartão)</div>
                    </div>

                    <div class="form-group">
                        <label for="card_titulo">Título/Profissão</label>
                        <div class="input-group-card-text-style">
                            <input type="text" id="card_titulo" name="card_titulo" value="{{ dados.card_titulo }}" class="form-input" oninput="updateTextPreview('card_titulo_preview', this.value, getValue('card_titulo_font'), getValue('card_titulo_color'))">
                            <select id="card_titulo_font" name="card_titulo_font" class="form-input" onchange="updateTextPreview('card_titulo_preview', getValue('card_titulo'), this.value, getValue('card_titulo_color'))">
                               <option value="Inter, sans-serif" {% if dados.card_titulo_font == 'Inter, sans-serif' %}selected{% endif %}>Padrão (Inter)</option>
                                <option value="Arial, sans-serif" {% if dados.card_titulo_font == 'Arial, sans-serif' %}selected{% endif %}>Arial</option>
                                <option value="Verdana, sans-serif" {% if dados.card_titulo_font == 'Verdana, sans-serif' %}selected{% endif %}>Verdana</option>
                                <option value="Georgia, serif" {% if dados.card_titulo_font == 'Georgia, serif' %}selected{% endif %}>Georgia</option>
                                <option value="'Times New Roman', Times, serif" {% if dados.card_titulo_font == "'Times New Roman', Times, serif" %}selected{% endif %}>Times New Roman</option>
                                <option value="'Courier New', Courier, monospace" {% if dados.card_titulo_font == "'Courier New', Courier, monospace" %}selected{% endif %}>Courier New</option>
                                <option value="Roboto, sans-serif" {% if dados.card_titulo_font == 'Roboto, sans-serif' %}selected{% endif %}>Roboto</option>
                                <option value="'Open Sans', sans-serif" {% if dados.card_titulo_font == "'Open Sans', sans-serif" %}selected{% endif %}>Open Sans</option>
                                <option value="Lato, sans-serif" {% if dados.card_titulo_font == 'Lato, sans-serif' %}selected{% endif %}>Lato</option>
                                <option value="Montserrat, sans-serif" {% if dados.card_titulo_font == 'Montserrat, sans-serif' %}selected{% endif %}>Montserrat</option>
                            </select>
                            <input type="color" id="card_titulo_color" name="card_titulo_color" value="{{ dados.card_titulo_color | default(DEFAULT_TITLE_COLOR_CARD, true) }}" oninput="updateTextPreview('card_titulo_preview', getValue('card_titulo'), getValue('card_titulo_font'), this.value)">
                        </div>
                         <div class="text-preview" id="card_titulo_preview">Prévia do Título</div>
                    </div>

                    <div class="form-group">
                        <label for="card_registro_profissional">Registro Profissional (Ex: CREA, OAB)</label>
                        <div class="input-group-card-text-style">
                            <input type="text" id="card_registro_profissional" name="card_registro_profissional" value="{{ dados.card_registro_profissional }}" class="form-input" oninput="updateTextPreview('card_registro_preview', this.value, getValue('card_registro_font'), getValue('card_registro_color'))">
                            <select id="card_registro_font" name="card_registro_font" class="form-input" onchange="updateTextPreview('card_registro_preview', getValue('card_registro_profissional'), this.value, getValue('card_registro_color'))">
                                <option value="Inter, sans-serif" {% if dados.card_registro_font == 'Inter, sans-serif' %}selected{% endif %}>Padrão (Inter)</option>
                                <option value="Arial, sans-serif" {% if dados.card_registro_font == 'Arial, sans-serif' %}selected{% endif %}>Arial</option>
                                <option value="Verdana, sans-serif" {% if dados.card_registro_font == 'Verdana, sans-serif' %}selected{% endif %}>Verdana</option>
                                <option value="Georgia, serif" {% if dados.card_registro_font == 'Georgia, serif' %}selected{% endif %}>Georgia</option>
                                <option value="'Times New Roman', Times, serif" {% if dados.card_registro_font == "'Times New Roman', Times, serif" %}selected{% endif %}>Times New Roman</option>
                                <option value="'Courier New', Courier, monospace" {% if dados.card_registro_font == "'Courier New', Courier, monospace" %}selected{% endif %}>Courier New</option>
                                <option value="Roboto, sans-serif" {% if dados.card_registro_font == 'Roboto, sans-serif' %}selected{% endif %}>Roboto</option>
                                <option value="'Open Sans', sans-serif" {% if dados.card_registro_font == "'Open Sans', sans-serif" %}selected{% endif %}>Open Sans</option>
                                <option value="Lato, sans-serif" {% if dados.card_registro_font == 'Lato, sans-serif' %}selected{% endif %}>Lato</option>
                                <option value="Montserrat, sans-serif" {% if dados.card_registro_font == 'Montserrat, sans-serif' %}selected{% endif %}>Montserrat</option>
                            </select>
                            <input type="color" id="card_registro_color" name="card_registro_color" value="{{ dados.card_registro_color | default(DEFAULT_REG_COLOR_CARD, true) }}" oninput="updateTextPreview('card_registro_preview', getValue('card_registro_profissional'), getValue('card_registro_font'), this.value)">
                        </div>
                        <div class="text-preview" id="card_registro_preview">Prévia do Registro</div>
                    </div>

                    <div class="form-group">
                        <label>Background do Cartão:</label>
                        <div class="card-background-options">
                            <label>
                                <input type="radio" name="card_background_type" value="color" {% if dados.card_background_type == 'color' or dados.card_background_type is none %}checked{% endif %}>
                                Cor Sólida
                                <input type="color" id="card_background_color_picker" name="card_background_value_color" value="{{ dados.card_background_value if dados.card_background_type == 'color' else '#4361ee' }}" class="form-input" style="width: 50px; height: 30px; padding:0; border: none;">
                            </label>
                            <label>
                                <input type="radio" name="card_background_type" value="image" {% if dados.card_background_type == 'image' %}checked{% endif %}>
                                Imagem
                            </label>
                        </div>
                        <div id="card_background_image_upload_section" style="display: {% if dados.card_background_type == 'image' %}block{% else %}none{% endif %};">
                            <div class="file-upload-wrapper">
                                <div class="file-upload">
                                    <input type="file" id="card_background_upload" name="card_background_upload" accept="image/*" class="file-input"
                                        onchange="previewImage(this, 'card_background_image_preview', 'card_background_info');">
                                    <label for="card_background_upload" class="file-label">
                                        <i class="fas fa-cloud-upload-alt"></i> Escolher imagem para o cartão
                                    </label>
                                </div>
                                <div class="file-info" id="card_background_info">
                                    {% if dados.card_background_type == 'image' and dados.card_background_value %}
                                        {% else %}
                                        Nenhum arquivo selecionado
                                    {% endif %}
                                </div>
                                <div class="image-preview-container" id="card_background_image_preview_container" style="display: {% if dados.card_background_type == 'image' and dados.card_background_value %}block{% else %}none{% endif %};">
                                    <img src="{{ dados.card_background_value if dados.card_background_type == 'image' else '' }}" class="image-preview" id="card_background_image_preview"
                                        onerror="this.style.display='none'">
                                    {% if dados.card_background_type == 'image' and dados.card_background_value %}
                                    <button type="button" class="btn-delete btn-sm" id="remove_card_background_image_btn" style="margin-top: 10px; display: inline-flex; align-items: center; gap: 5px;"><i class="fas fa-times-circle"></i>Remover Imagem</button>
                                    {% else %}
                                    <button type="button" class="btn-delete btn-sm" id="remove_card_background_image_btn" style="margin-top: 10px; display: none; align-items: center; gap: 5px;"><i class="fas fa-times-circle"></i>Remover Imagem</button>
                                    {% endif %}
                                    <input type="hidden" name="remove_card_background_image" id="remove_card_background_image" value="false">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="form-group form-group-inline">
                        <label for="card_link_text_color">Cor Global do Texto dos Links do Cartão (Fallback):</label>
                        <input type="color" id="card_link_text_color" name="card_link_text_color" value="{{ dados.card_link_text_color | default(DEFAULT_CARD_LINK_TEXT_COLOR, true) }}">
                    </div>

                    <div class="form-group">
                        <label>Links Customizáveis do Cartão (até 3)</label>
                        <button type="button" class="btn btn-add" id="add-card-link-btn">
                            <i class="fas fa-plus"></i> Adicionar Link ao Cartão
                        </button>
                        <div id="card-links-container">
                            {% if dados.card_links %}
                                {% for link in dados.card_links %}
                                <div class="card-link-item">
                                    <i class="fas fa-grip-vertical drag-handle"></i>
                                    <img src="/static/icons/{{ link.icon }}.png" alt="{{ link.icon }}" width="24">
                                    <input type="hidden" name="card_icon_name[]" value="{{ link.icon }}">
                                    <div class="input-group">
                                        <input type="text" name="card_icon_url[]"
                                                    value="{{ link.url }}"
                                                    placeholder="URL (Opcional)"
                                                    class="form-input">
                                        <input type="text" name="card_icon_at_text[]"
                                                    value="{{ link.at_text }}"
                                                    placeholder="@texto"
                                                    class="form-input card-link-item-at-text">
                                    </div>
                                    <div class="card-link-style-controls">
                                        <input type="hidden" name="card_icon_font[]" value="{{ link.font | default(DEFAULT_FONT, true) }}">
                                        <select class="form-input card-link-item-font">
                                            <option value="Inter, sans-serif" {% if (link.font | default(DEFAULT_FONT, true)) == 'Inter, sans-serif' %}selected{% endif %}>Padrão (Inter)</option>
                                            <option value="Arial, sans-serif" {% if (link.font | default(DEFAULT_FONT, true)) == 'Arial, sans-serif' %}selected{% endif %}>Arial</option>
                                            <option value="Verdana, sans-serif" {% if (link.font | default(DEFAULT_FONT, true)) == 'Verdana, sans-serif' %}selected{% endif %}>Verdana</option>
                                            <option value="Georgia, serif" {% if (link.font | default(DEFAULT_FONT, true)) == 'Georgia, serif' %}selected{% endif %}>Georgia</option>
                                            <option value="'Times New Roman', Times, serif" {% if (link.font | default(DEFAULT_FONT, true)) == "'Times New Roman', Times, serif" %}selected{% endif %}>Times New Roman</option>
                                            <option value="'Courier New', Courier, monospace" {% if (link.font | default(DEFAULT_FONT, true)) == "'Courier New', Courier, monospace" %}selected{% endif %}>Courier New</option>
                                            <option value="Roboto, sans-serif" {% if (link.font | default(DEFAULT_FONT, true)) == 'Roboto, sans-serif' %}selected{% endif %}>Roboto</option>
                                            <option value="'Open Sans', sans-serif" {% if (link.font | default(DEFAULT_FONT, true)) == "'Open Sans', sans-serif" %}selected{% endif %}>Open Sans</option>
                                            <option value="Lato, sans-serif" {% if (link.font | default(DEFAULT_FONT, true)) == 'Lato, sans-serif' %}selected{% endif %}>Lato</option>
                                            <option value="Montserrat, sans-serif" {% if (link.font | default(DEFAULT_FONT, true)) == 'Montserrat, sans-serif' %}selected{% endif %}>Montserrat</option>
                                        </select>
                                        <input type="hidden" name="card_icon_color[]" value="{{ link.color | default(DEFAULT_TEXT_COLOR_CARD, true) }}">
                                        <input type="color" class="card-link-item-color" value="{{ link.color | default(DEFAULT_TEXT_COLOR_CARD, true) }}">
                                    </div>
                                    <div class="card-link-item-preview"></div> <span class="remove-item"><i class="fas fa-times"></i></span>
                                </div>
                                {% endfor %}
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>

            <div class="form-actions">
                <button type="submit" class="btn-save">
                    <i class="fas fa-save"></i> Salvar Alterações
                </button>
                <a href="{{ url_for('logout') }}" class="btn-logout">
                    <i class="fas fa-sign-out-alt"></i> Sair
                </a>
            </div>
        </form>
    </div>
    <script>
        // Passando constantes do Flask para o JavaScript
        const DEFAULT_FONT_JS = "{{ DEFAULT_FONT | e }}";
        const DEFAULT_TEXT_COLOR_CARD_JS = "{{ DEFAULT_TEXT_COLOR_CARD | e }}";
    </script>
    <script src="{{ url_for('static', filename='js/admin.js') }}" defer></script>
    <script src="{{ url_for('static', filename='js/dark-mode.js') }}"></script>
    <a href="/{{ dados.profile }}" class="preview-float-btn" target="_blank">
        <i class="fas fa-eye"></i>
        <span class="preview-float-tooltip">Visualizar Página</span>
    </a>
</body>
</html>